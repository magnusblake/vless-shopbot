{% extends "base.html" %}
{% block title %}Управление Пользователями{% endblock %}
{% block content %}

<div class="space-y-6">
	<div>
		<h1 class="text-3xl font-bold tracking-tight">Управление Пользователями</h1>
		<p class="text-muted-foreground mt-1">Просмотр и управление пользователями системы</p>
	</div>

	<div class="rounded-lg border border-border bg-card shadow-sm">
		<div class="p-6">
			<h2 class="text-xl font-semibold mb-4">Список пользователей</h2>
			<div class="overflow-x-auto">
				<table class="w-full">
					<thead>
						<tr class="border-b border-border">
							<th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Telegram ID</th>
							<th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Username</th>
							<th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Статус</th>
							<th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Активные ключи</th>
							<th class="text-right py-3 px-4 text-sm font-medium text-muted-foreground">Действия</th>
						</tr>
					</thead>
					<tbody>
						{% for user in users %}
						<tr class="border-b border-border transition-colors hover:bg-secondary/50">
							<td class="py-3 px-4 text-sm">{{ user.telegram_id }}</td>
							<td class="py-3 px-4 text-sm">@{{ user.username or 'N/A' }}</td>
							<td class="py-3 px-4">
								{% if user.is_banned %}
								<span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium bg-destructive/10 text-destructive">
									Забанен
								</span>
								{% else %}
								<span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium bg-green-500/10 text-green-500">
									Активен
								</span>
								{% endif %}
							</td>
							<td class="py-3 px-4 text-sm">
								{% if user.user_keys %}
								{{ user.user_keys | length }} шт.
								{% else %}
								0
								{% endif %}
							</td>
							<td class="py-3 px-4">
								<div class="flex items-center justify-end space-x-2">
									{% if user.is_banned %}
									<form
										action="{{ url_for('unban_user_route', user_id=user.telegram_id) }}"
										method="post"
										class="inline"
									>
										<button
											type="submit"
											class="inline-flex items-center justify-center rounded-md text-xs font-medium h-8 px-3 bg-green-500/10 text-green-500 hover:bg-green-500/20 transition-colors"
										>
											Разбанить
										</button>
									</form>
									{% else %}
									<form
										action="{{ url_for('ban_user_route', user_id=user.telegram_id) }}"
										method="post"
										data-confirm="Вы уверены, что хотите забанить этого пользователя? Он не сможет пользоваться ботом."
										class="inline"
									>
										<button
											type="submit"
											class="inline-flex items-center justify-center rounded-md text-xs font-medium h-8 px-3 bg-yellow-500/10 text-yellow-500 hover:bg-yellow-500/20 transition-colors"
										>
											Бан
										</button>
									</form>
									{% endif %}

									{% if user.user_keys %}
									<form
										action="{{ url_for('revoke_keys_route', user_id=user.telegram_id) }}"
										method="post"
										data-confirm="ВНИМАНИЕ! Это действие удалит ВСЕ ключи пользователя с серверов. Вы уверены?"
										class="inline"
									>
										<button
											type="submit"
											class="inline-flex items-center justify-center rounded-md text-xs font-medium h-8 px-3 bg-destructive/10 text-destructive hover:bg-destructive/20 transition-colors"
										>
											Отозвать
										</button>
									</form>
									{% endif %}
								</div>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

{% endblock %}
